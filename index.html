<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inicio de Sesión</title>
  <style>
    /* Fondo cuadriculado */
    .container {
      width: 100%;
      height: 100vh;
      --color: rgba(114, 114, 114, 0.3);
      background-color: #191a1a;
      background-image: linear-gradient(0deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent),
          linear-gradient(90deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent);
      background-size: 55px 55px;

      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Caja del formulario */
    .form_area {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background-color: #EDDCD9;
      border: 2px solid #264143;
      border-radius: 20px;
      box-shadow: 3px 4px 0px 1px #E99F4C;
      padding: 20px;
      text-align: center;
    }

    .title {
      color: #264143;
      font-weight: 900;
      font-size: 1.5em;
      margin-top: 10px;
    }

    .sub_title {
      font-weight: 600;
      margin: 5px 0;
    }

    .form_group {
      display: flex;
      flex-direction: column;
      align-items: baseline;
      margin: 10px;
    }

    .form_style {
      outline: none;
      border: 2px solid #264143;
      box-shadow: 3px 4px 0px 1px #E99F4C;
      width: 290px;
      padding: 12px 10px;
      border-radius: 4px;
      font-size: 15px;
    }

    .form_style:focus, .btn:focus {
      transform: translateY(4px);
      box-shadow: 1px 2px 0px 0px #E99F4C;
    }

    .btn {
      padding: 15px;
      margin: 25px 0px;
      width: 290px;
      font-size: 15px;
      background: #DE5499;
      border-radius: 10px;
      font-weight: 800;
      box-shadow: 3px 3px 0px 0px #E99F4C;
      border: none;
      cursor: pointer;
    }

    .btn:hover {
      opacity: .9;
    }

    .link {
      font-weight: 800;
      color: #264143;
      padding: 5px;
      cursor: pointer;
    }
  </style>
</head>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  (function(){
    emailjs.init("4S8oKnuDcpg5Pnv0b");
  })();
</script>
<body>
     <!-- Anuncio de Google -->
<div class="container">
    <!-- Tu contenido arriba -->

    <!-- Anuncio in-article -->
    <ins class="adsbygoogle"
         style="display:block; text-align:center;"
         data-ad-layout="in-article"
         data-ad-format="fluid"
         data-ad-client="ca-pub-4006965729567771"
         data-ad-slot="7518369966"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
    <!-- Panel de login -->
    <div id="panelLogin" class="form_area">
      <p class="title">LOGIN</p>
      <form id="formLogin">
        <div class="form_group">
          <label class="sub_title" for="loginCorreo">Email</label>
          <input placeholder="Correo electrónico" id="loginCorreo" class="form_style" type="email" required>
        </div>
        <div class="form_group">
          <label class="sub_title" for="loginClave">Password</label>
          <input placeholder="Contraseña" id="loginClave" class="form_style" type="password" required>
        </div>
        <button type="submit" class="btn">Iniciar Sesión</button>
      </form>
      <p>¿No tienes cuenta? <span class="link" onclick="mostrarRegistro()">Regístrate aquí</span></p>
    </div>

    <!-- Panel de registro -->
    <div id="panelRegistro" class="form_area" style="display:none;">
      <p class="title">SIGN UP</p>
      <form id="formRegistro">
        <div class="form_group">
          <label class="sub_title" for="nombre">Nombre completo</label>
          <input placeholder="Ingresa tu nombre" id="nombre" class="form_style" type="text" required>
        </div>
        <div class="form_group">
          <label class="sub_title" for="correo">Email</label>
          <input placeholder="Ingresa tu correo" id="correo" class="form_style" type="email" required>
        </div>
        <div class="form_group">
          <label class="sub_title" for="clave">Password</label>
          <input placeholder="Contraseña (no la del correo)" id="clave" class="form_style" type="password" required>
        </div>
        <button type="submit" class="btn">Registrarse</button>
      </form>
      <p>¿Ya tienes cuenta? <span class="link" onclick="mostrarLogin()">Inicia sesión aquí</span></p>
    </div>

    <!-- Panel de usuario -->
    <!-- Panel de usuario -->
<div id="panelUsuario" class="form_area" style="display:none;">
  <p id="info"></p>
  <p id="saldo"></p>
  <p id="aviso"></p>

  <button id="pagoEconomico" class="btn">Paquete $50</button>
  <button id="pagoPremium" class="btn">Paquete $150</button>

  <button id="cerrarSesion" class="btn">Cerrar Sesión</button>
</div>
    </div>
  </div>

  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1ZN3FisKZoRoJY4XInerpgUjjqv0d-8I",
  authDomain: "protex-93fae.firebaseapp.com",
  projectId: "protex-93fae",
  storageBucket: "protex-93fae.firebasestorage.app",
  messagingSenderId: "111543961960",
  appId: "1:111543961960:web:27e19f920f08a7126e6edd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- REGISTRO ---
document.getElementById("formRegistro").addEventListener("submit", async (e) => {
  e.preventDefault();

  const nombre = document.getElementById("nombre").value;
  const correo = document.getElementById("correo").value;
  const clave = document.getElementById("clave").value;

  if (!nombre || !correo || !clave) return alert("Completa todos los campos");

  const ref = doc(db, "usuarios", correo);
  const snap = await getDoc(ref);

  if (snap.exists()) return alert("Ese correo ya está registrado");

  await setDoc(ref, {
    nombre,
    correo,
    clave,
    codigo: "COD-" + Math.random().toString(36).substr(2, 8).toUpperCase(),
    saldo: 0
  });

  alert("Usuario registrado correctamente. Ahora inicia sesión.");
  mostrarLogin();
});

// --- LOGIN ---
document.getElementById("formLogin").addEventListener("submit", async (e) => {
  e.preventDefault();

  const correo = document.getElementById("loginCorreo").value;
  const clave = document.getElementById("loginClave").value;

  const ref = doc(db, "usuarios", correo);
  const snap = await getDoc(ref);

  if (!snap.exists()) return alert("Usuario no existe");

  const data = snap.data();
  if (data.clave !== clave) return alert("Contraseña incorrecta");
  
  localStorage.setItem("correoUsuario", correo);
localStorage.setItem("nombreUsuario", data.nombre);
localStorage.setItem("codigoUsuario", data.codigo);

  // Mostrar panel de usuario
  document.getElementById("panelLogin").style.display = "none";
  document.getElementById("panelUsuario").style.display = "block";
  document.getElementById("info").textContent = "Hola " + data.nombre;
  document.getElementById("saldo").textContent = "Saldo: $" + data.saldo;
});

// --- AUTO LOGIN ---
window.addEventListener("load", async () => {
  const guardado = localStorage.getItem("correoUsuario");
  if (!guardado) return;

  const ref = doc(db, "usuarios", guardado);
  const snap = await getDoc(ref);
  if (!snap.exists()) return;

  const data = snap.data();
  document.getElementById("panelLogin").style.display = "none";
  document.getElementById("panelUsuario").style.display = "block";
  document.getElementById("info").textContent = "Hola " + data.nombre;
  document.getElementById("saldo").textContent = "Saldo: $" + data.saldo;
});
// --- CERRAR SESIÓN ---
document.getElementById("cerrarSesion").addEventListener("click", () => {
  localStorage.removeItem("correoUsuario"); // Borra el usuario guardado
  document.getElementById("panelUsuario").style.display = "none";
  document.getElementById("panelLogin").style.display = "block";
});

// --- MOSTRAR REGISTRO ---
window.mostrarRegistro = function () {
  document.getElementById("panelLogin").style.display = "none";
  document.getElementById("panelRegistro").style.display = "block";
  document.getElementById("panelUsuario").style.display = "none";
};

// --- MOSTRAR LOGIN ---
window.mostrarLogin = function () {
  document.getElementById("panelRegistro").style.display = "none";
  document.getElementById("panelLogin").style.display = "block";
  document.getElementById("panelUsuario").style.display = "none";
};
// --- DETECTAR PAGO SIMULADO ---
const params = new URLSearchParams(window.location.search);
const success = params.get("success");
const pack = params.get("pack");

if (success === "true" && pack) {
  const correo = localStorage.getItem("correoUsuario");

  if (correo) {
    const ref = doc(db, "usuarios", correo);
    const snap = await getDoc(ref);

    if (snap.exists()) {
      let saldoActual = snap.data().saldo;
      let aumento = pack === "50" ? 50 : 150;

      await setDoc(ref, {
        ...snap.data(),
        saldo: saldoActual + aumento
      });

      document.getElementById("saldo").textContent =
        "Saldo: $" + (saldoActual + aumento);

      alert("Pago exitoso. Se recargó tu saldo.");

      // Limpia la URL
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  }
}
document.addEventListener("DOMContentLoaded", () => {

  const btnEco = document.getElementById("pagoEconomico");
  const btnPro = document.getElementById("pagoPremium");

  if (btnEco) {
    btnEco.addEventListener("click", () => {
      window.location.href = window.location.pathname + "?success=true&pack=50";
    });
  }

  if (btnPro) {
    btnPro.addEventListener("click", () => {
      window.location.href = window.location.pathname + "?success=true&pack=150";
    });
  }

});
</script>
<script src="https://js.stripe.com/v3/"></script>
</body>
</html>